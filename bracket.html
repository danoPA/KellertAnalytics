<!DOCTYPE html>
<html>

  <head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">

<title>Kellert Analytics</title>

<script src="//ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>
<script src="//netdna.bootstrapcdn.com/bootstrap/3.1.1/js/bootstrap.min.js"></script>
<script src="http://mbostock.github.com/d3/d3.v2.js"></script>
<link rel="stylesheet" type="text/css" href="//netdna.bootstrapcdn.com/bootstrap/3.1.1/css/bootstrap.min.css">

<style type="text/css">
    body {
        padding-top: 50px;
        padding-bottom: 20px;
    }
    .nottop{
       display:none;
    }

    .node circle {
      cursor: pointer;
      fill: #fff;
      stroke: steelblue;
      stroke-width: 1.5px;
    }

    .node text {
      font: 12px sans-serif;
    }

    path.link {
      fill: none;
      stroke: #ccc;
      stroke-width: 1.5px;
    }
</style>

<!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>

<body>

<!-- Fixed Navbar -->
<nav class="navbar navbar-inverse navbar-fixed-top">
    <div class="container">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="sr-only">Toggle Navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="/">Kellert Analytics</a>
        </div>

        <div id="navbar" class="navbar-collapse collapse">

            <ul class="nav navbar-nav navbar-right">
                <li><a href="/powerrankings">Power Rankings</a></li>
                <li><a href="/stats">Stats</a></li>
                <li><a href="/projections">Projections</a></li>
                <li><a href="/bracket">Bracket</a></li>
            </ul>
        </div><!--/.nav-collapse -->
    </div>
</nav>

<div id="chart"></div>

<script type="text/javascript">
var margin = {top: 30, right: 10, bottom: 10, left: 10},
    width = 2000 - margin.left - margin.right,
    halfWidth = width / 2,
    height = 1500 - margin.top - margin.bottom,
    i = 0,
    duration = 500,
    root;

var getChildren = function(d){
      var a = [];
      if(d.left) for(var i = 0; i < d.left.length; i++){
        d.left[i].isRight = false;
        d.left[i].parent = d;
        a.push(d.left[i]);
      }
      if(d.right) for(var i = 0; i < d.right.length; i++){
        d.right[i].isRight = true;
        d.right[i].parent = d;
        a.push(d.right[i]);
      }
      return a.length?a:null;
    }
    ;

var tree = d3.layout.tree()
    .size([height, width])
    ;

var diagonal = d3.svg.diagonal()
    .projection(function(d) { return [d.y, d.x]; });
var elbow = function (d, i){
      var source = calcLeft(d.source);
      var target = calcLeft(d.target);
      var hy = (target.y-source.y)/2;
      if(d.isRight) hy = -hy;
      return "M" + source.y + "," + source.x
             + "H" + (source.y+hy)
             + "V" + target.x + "H" + target.y;
    };
var connector = elbow;

var calcLeft = function(d){
  var l = d.y;
  if(!d.isRight){
    l = d.y-halfWidth;
    l = halfWidth - l;
  }
  return {x : d.x, y : l};
};

var vis = d3.select("#chart").append("svg")
    .attr("width", width + margin.right + margin.left)
    .attr("height", height + margin.top + margin.bottom)
  .append("g")
    .attr("transform", "translate(" + margin.left + "," + margin.top + ")")
        .on({
            "mouseover": function(d) {
                d3.select(this).style("cursor", "pointer");
            },
            "mouseout": function(d) {
                d3.select(this).style("cursor", "grab");
            }
        });


var list_to_tree = function(bracket){
var test_dict = Object;
  var keys = [];
  for(key in bracket){
    if(bracket.hasOwnProperty(key)){
      keys.push(key);
    }
  };
  for(var i=1; i < 8; i++){
    var left_teams = [];
    var right_teams = [];
    keys.forEach(function(key){
      if(bracket[key]["depth"] == i & bracket[key]["side"] == "left"){left_teams.push([key, bracket[key]]);}
      else if(bracket[key]["depth"] == i & bracket[key]["side"] == "right"){right_teams.push([key, bracket[key]]);};
    });
    test_dict[("left" + i)] = left_teams.sort();
    test_dict[("right" + i)] = right_teams.sort();
  };
  var slots = Object();
  slots.name = "Champion";
  slots.seed_id = "CHAMP"
  slots.left = 
[{
"name": "left champion",
"seed_id": "L1",
"left":
[
{
  "name": test_dict[("left2")][0][1]["team"],
  "seed_id": test_dict[("left2")][0][0],
  "left": [
              {
                  "name": test_dict[("left3")][0][1]['team'],
                  "seed_id": test_dict[("left3")][0][0],
                  "left": [
                          {
                          "name": test_dict[("left4")][0][1]['team'],
                          "seed_id": test_dict[("left4")][0][0],
                          "left": [
                          {
                          "name": test_dict[("left5")][0][1]['team'],
                          "seed_id": test_dict[("left5")][0][0],
                          "left": [
                          {
                          "name": test_dict[("left6")][0][1]['team'],
                          "seed_id": test_dict[("left6")][0][0]
                          },
                          {
                          "name": test_dict[("left6")][1][1]['team'],
                          "seed_id": test_dict[("left6")][1][0]
                          }   
                          ]
                          },
                          {
                          "name": test_dict[("left5")][1][1]['team'],
                          "seed_id": test_dict[("left5")][1][0],
                          "left": [
                          {
                          "name": test_dict[("left6")][2][1]['team'],
                          "seed_id": test_dict[("left6")][2][0]
                          },
                          {
                          "name": test_dict[("left6")][3][1]['team'],
                          "seed_id": test_dict[("left6")][3][0]
                          }    
                          ]
                          }
                          ]
                          },
                          {
                          "name": test_dict[("left4")][1][1]['team'],
                          "seed_id": test_dict[("left4")][1][0],
                          "left": [
                          {
                          "name": test_dict[("left5")][2][1]['team'],
                          "seed_id": test_dict[("left5")][2][0],
                          "left": [
                          {
                          "name": test_dict[("left6")][4][1]['team'],
                          "seed_id": test_dict[("left6")][4][0]
                          },
                          {
                          "name": test_dict[("left6")][5][1]['team'],
                          "seed_id": test_dict[("left6")][5][0]
                          }    
                          ]
                          },
                          {
                          "name": test_dict[("left5")][3][1]['team'],
                          "seed_id": test_dict[("left5")][3][0],
                          "left": [
                          {
                          "name": test_dict[("left6")][6][1]['team'],
                          "seed_id": test_dict[("left6")][6][0]
                          },
                          {
                          "name": test_dict[("left6")][7][1]['team'],
                          "seed_id": test_dict[("left6")][7][0]
                          }    
                          ]
                          }
                          ]
                          }
              ]
              },
              {
                  "name": test_dict[("left3")][1][1]['team'],
                  "seed_id": test_dict[("left3")][1][0],
                  "left": [
                          {
                          "name": test_dict[("left4")][2][1]['team'],
                          "seed_id": test_dict[("left4")][2][0],
                          "left": [
                          {
                          "name": test_dict[("left5")][4][1]['team'],
                          "seed_id": test_dict[("left5")][4][0],
                          "left": [
                          {
                          "name": test_dict[("left6")][8][1]['team'],
                          "seed_id": test_dict[("left6")][8][0]
                          },
                          {
                          "name": test_dict[("left6")][9][1]['team'],
                          "seed_id": test_dict[("left6")][9][0]
                          }    
                          ]
                          },
                          {
                          "name": test_dict[("left5")][5][1]['team'],
                          "seed_id": test_dict[("left5")][5][0],
                          "left": [
                          {
                          "name": test_dict[("left6")][10][1]['team'],
                          "seed_id": test_dict[("left6")][10][0]
                          },
                          {
                          "name": test_dict[("left6")][11][1]['team'],
                          "seed_id": test_dict[("left6")][11][0]
                          }    
                          ]
                          }
                          ]
                          },
                          {
                          "name": test_dict[("left4")][3][1]['team'],
                          "seed_id": test_dict[("left4")][3][0],
                          "left": [
                          {
                          "name": test_dict[("left5")][6][1]['team'],
                          "seed_id": test_dict[("left5")][6][0],
                          "left": [
                          {
                          "name": test_dict[("left6")][12][1]['team'],
                          "seed_id": test_dict[("left6")][12][0]
                          },
                          {
                          "name": test_dict[("left6")][13][1]['team'],
                          "seed_id": test_dict[("left6")][13][0]
                          }    
                          ]
                          },
                          {
                          "name": test_dict[("left5")][7][1]['team'],
                          "seed_id": test_dict[("left5")][7][0],
                          "left": [
                          {
                          "name": test_dict[("left6")][14][1]['team'],
                          "seed_id": test_dict[("left6")][14][0]
                          },
                          {
                          "name": test_dict[("left6")][15][1]['team'],
                          "seed_id": test_dict[("left6")][15][0]
                          }    
                          ]
                          }
                          ]
                          }
              ]
              }
]
},
{
  "name": test_dict[("left2")][1][1]['team'],
  "seed_id": test_dict[("left2")][1][0],
  "left": [
              {
                  "name": test_dict[("left3")][2][1]['team'],
                  "seed_id": test_dict[("left3")][2][0],
                  "left": [
                          {
                          "name": test_dict[("left4")][4][1]['team'],
                          "seed_id": test_dict[("left4")][4][0],
                          "left": [
                          {
                          "name": test_dict[("left5")][8][1]['team'],
                          "seed_id": test_dict[("left5")][8][0],
                          "left": [
                          {
                          "name": test_dict[("left6")][16][1]['team'],
                          "seed_id": test_dict[("left6")][16][0]
                          },
                          {
                          "name": test_dict[("left6")][17][1]['team'],
                          "seed_id": test_dict[("left6")][17][0]
                          }    
                          ]
                          },
                          {
                          "name": test_dict[("left5")][9][1]['team'],
                          "seed_id": test_dict[("left5")][9][0],
                          "left": [
                          {
                          "name": test_dict[("left6")][18][1]['team'],
                          "seed_id": test_dict[("left6")][18][0]
                          },
                          {
                          "name": test_dict[("left6")][19][1]['team'],
                          "seed_id": test_dict[("left6")][19][0]
                          }    
                          ]
                          }
                          ]
                          },
                          {
                          "name": test_dict[("left4")][5][1]['team'],
                          "seed_id": test_dict[("left4")][5][0],
                          "left": [
                          {
                          "name": test_dict[("left5")][10][1]['team'],
                          "seed_id": test_dict[("left5")][10][0],
                          "left": [
                          {
                          "name": test_dict[("left6")][20][1]['team'],
                          "seed_id": test_dict[("left6")][20][0]
                          },
                          {
                          "name": test_dict[("left6")][21][1]['team'],
                          "seed_id": test_dict[("left6")][21][0]
                          }    
                          ]
                          },
                          {
                          "name": test_dict[("left5")][11][1]['team'],
                          "seed_id": test_dict[("left5")][11][0],
                          "left": [
                          {
                          "name": test_dict[("left6")][22][1]['team'],
                          "seed_id": test_dict[("left6")][22][0]
                          },
                          {
                          "name": test_dict[("left6")][23][1]['team'],
                          "seed_id": test_dict[("left6")][23][0]
                          }    
                          ]
                          }
                          ]
                          }
              ]
              },
              {
                  "name": test_dict[("left3")][3][1]['team'],
                  "seed_id": test_dict[("left3")][3][0],
                  "left": [
                          {
                          "name": test_dict[("left4")][6][1]['team'],
                          "seed_id": test_dict[("left4")][6][0],
                          "left": [
                          {
                          "name": test_dict[("left5")][12][1]['team'],
                          "seed_id": test_dict[("left5")][12][0],
                          "left": [
                          {
                          "name": test_dict[("left6")][24][1]['team'],
                          "seed_id": test_dict[("left6")][24][0]
                          },
                          {
                          "name": test_dict[("left6")][25][1]['team'],
                          "seed_id": test_dict[("left6")][25][0]
                          }    
                          ]
                          },
                          {
                          "name": test_dict[("left5")][13][1]['team'],
                          "seed_id": test_dict[("left5")][13][0],
                          "left": [
                          {
                          "name": test_dict[("left6")][26][1]['team'],
                          "seed_id": test_dict[("left6")][26][0]
                          },
                          {
                          "name": test_dict[("left6")][27][1]['team'],
                          "seed_id": test_dict[("left6")][27][0]
                          }    
                          ]
                          }
                          ]
                          },
                          {
                          "name": test_dict[("left4")][7][1]['team'],
                          "seed_id": test_dict[("left4")][7][0],
                          "left": [
                          {
                          "name": test_dict[("left5")][14][1]['team'],
                          "seed_id": test_dict[("left5")][14][0],
                          "left": [
                          {
                          "name": test_dict[("left6")][28][1]['team'],
                          "seed_id": test_dict[("left6")][28][0]
                          },
                          {
                          "name": test_dict[("left6")][29][1]['team'],
                          "seed_id": test_dict[("left6")][29][0]
                          }    
                          ]
                          },
                          {
                          "name": test_dict[("left5")][15][1]['team'],
                          "seed_id": test_dict[("left5")][15][0],
                          "left": [
                          {
                          "name": test_dict[("left6")][30][1]['team'],
                          "seed_id": test_dict[("left6")][30][0]
                          },
                          {
                          "name": test_dict[("left6")][31][1]['team'],
                          "seed_id": test_dict[("left6")][31][0]
                          }    
                          ]
                          }
                          ]
                          }
              ]
              }
]
}
]}];
  slots.right =  
[{
"name": "right champion",
"seed_id": "R1",
"right":
[
{
  "name": test_dict[("right2")][0][1]["team"],
  "seed_id": test_dict[("right2")][0][0],
  "right": [
              {
                  "name": test_dict[("right3")][0][1]['team'],
                  "seed_id": test_dict[("right3")][0][0],
                  "right": [
                          {
                          "name": test_dict[("right4")][0][1]['team'],
                          "seed_id": test_dict[("right4")][0][0],
                          "right": [
                          {
                          "name": test_dict[("right5")][0][1]['team'],
                          "seed_id": test_dict[("right5")][0][0],
                          "right": [
                          {
                          "name": test_dict[("right6")][0][1]['team'],
                          "seed_id": test_dict[("right6")][0][0]
                          },
                          {
                          "name": test_dict[("right6")][1][1]['team'],
                          "seed_id": test_dict[("right6")][1][0]
                          }   
                          ]
                          },
                          {
                          "name": test_dict[("right5")][1][1]['team'],
                          "seed_id": test_dict[("right5")][1][0],
                          "right": [
                          {
                          "name": test_dict[("right6")][2][1]['team'],
                          "seed_id": test_dict[("right6")][2][0]
                          },
                          {
                          "name": test_dict[("right6")][3][1]['team'],
                          "seed_id": test_dict[("right6")][3][0]
                          }    
                          ]
                          }
                          ]
                          },
                          {
                          "name": test_dict[("right4")][1][1]['team'],
                          "seed_id": test_dict[("right4")][1][0],
                          "right": [
                          {
                          "name": test_dict[("right5")][2][1]['team'],
                          "seed_id": test_dict[("right5")][2][0],
                          "right": [
                          {
                          "name": test_dict[("right6")][4][1]['team'],
                          "seed_id": test_dict[("right6")][4][0]
                          },
                          {
                          "name": test_dict[("right6")][5][1]['team'],
                          "seed_id": test_dict[("right6")][5][0]
                          }    
                          ]
                          },
                          {
                          "name": test_dict[("right5")][3][1]['team'],
                          "seed_id": test_dict[("right5")][3][0],
                          "right": [
                          {
                          "name": test_dict[("right6")][6][1]['team'],
                          "seed_id": test_dict[("right6")][6][0]
                          },
                          {
                          "name": test_dict[("right6")][7][1]['team'],
                          "seed_id": test_dict[("right6")][7][0]
                          }    
                          ]
                          }
                          ]
                          }
              ]
              },
              {
                  "name": test_dict[("right3")][1][1]['team'],
                  "seed_id": test_dict[("right3")][1][0],
                  "right": [
                          {
                          "name": test_dict[("right4")][2][1]['team'],
                          "seed_id": test_dict[("right4")][2][0],
                          "right": [
                          {
                          "name": test_dict[("right5")][4][1]['team'],
                          "seed_id": test_dict[("right5")][4][0],
                          "right": [
                          {
                          "name": test_dict[("right6")][8][1]['team'],
                          "seed_id": test_dict[("right6")][8][0]
                          },
                          {
                          "name": test_dict[("right6")][9][1]['team'],
                          "seed_id": test_dict[("right6")][9][0]
                          }    
                          ]
                          },
                          {
                          "name": test_dict[("right5")][5][1]['team'],
                          "seed_id": test_dict[("right5")][5][0],
                          "right": [
                          {
                          "name": test_dict[("right6")][10][1]['team'],
                          "seed_id": test_dict[("right6")][10][0]
                          },
                          {
                          "name": test_dict[("right6")][11][1]['team'],
                          "seed_id": test_dict[("right6")][11][0]
                          }    
                          ]
                          }
                          ]
                          },
                          {
                          "name": test_dict[("right4")][3][1]['team'],
                          "seed_id": test_dict[("right4")][3][0],
                          "right": [
                          {
                          "name": test_dict[("right5")][6][1]['team'],
                          "seed_id": test_dict[("right5")][6][0],
                          "right": [
                          {
                          "name": test_dict[("right6")][12][1]['team'],
                          "seed_id": test_dict[("right6")][12][0]
                          },
                          {
                          "name": test_dict[("right6")][13][1]['team'],
                          "seed_id": test_dict[("right6")][13][0]
                          }    
                          ]
                          },
                          {
                          "name": test_dict[("right5")][7][1]['team'],
                          "seed_id": test_dict[("right5")][7][0],
                          "right": [
                          {
                          "name": test_dict[("right6")][14][1]['team'],
                          "seed_id": test_dict[("right6")][14][0]
                          },
                          {
                          "name": test_dict[("right6")][15][1]['team'],
                          "seed_id": test_dict[("right6")][15][0]
                          }    
                          ]
                          }
                          ]
                          }
              ]
              }
]
},
{
  "name": test_dict[("right2")][1][1]['team'],
  "seed_id": test_dict[("right2")][1][0],
  "right": [
              {
                  "name": test_dict[("right3")][2][1]['team'],
                  "seed_id": test_dict[("right3")][2][0],
                  "right": [
                          {
                          "name": test_dict[("right4")][4][1]['team'],
                          "seed_id": test_dict[("right4")][4][0],
                          "right": [
                          {
                          "name": test_dict[("right5")][8][1]['team'],
                          "seed_id": test_dict[("right5")][8][0],
                          "right": [
                          {
                          "name": test_dict[("right6")][16][1]['team'],
                          "seed_id": test_dict[("right6")][16][0]
                          },
                          {
                          "name": test_dict[("right6")][17][1]['team'],
                          "seed_id": test_dict[("right6")][17][0]
                          }    
                          ]
                          },
                          {
                          "name": test_dict[("right5")][9][1]['team'],
                          "seed_id": test_dict[("right5")][9][0],
                          "right": [
                          {
                          "name": test_dict[("right6")][18][1]['team'],
                          "seed_id": test_dict[("right6")][18][0]
                          },
                          {
                          "name": test_dict[("right6")][19][1]['team'],
                          "seed_id": test_dict[("right6")][19][0]
                          }    
                          ]
                          }
                          ]
                          },
                          {
                          "name": test_dict[("right4")][5][1]['team'],
                          "seed_id": test_dict[("right4")][5][0],
                          "right": [
                          {
                          "name": test_dict[("right5")][10][1]['team'],
                          "seed_id": test_dict[("right5")][10][0],
                          "right": [
                          {
                          "name": test_dict[("right6")][20][1]['team'],
                          "seed_id": test_dict[("right6")][20][0]
                          },
                          {
                          "name": test_dict[("right6")][21][1]['team'],
                          "seed_id": test_dict[("right6")][21][0]
                          }    
                          ]
                          },
                          {
                          "name": test_dict[("right5")][11][1]['team'],
                          "seed_id": test_dict[("right5")][11][0],
                          "right": [
                          {
                          "name": test_dict[("right6")][22][1]['team'],
                          "seed_id": test_dict[("right6")][22][0]
                          },
                          {
                          "name": test_dict[("right6")][23][1]['team'],
                          "seed_id": test_dict[("right6")][23][0]
                          }    
                          ]
                          }
                          ]
                          }
              ]
              },
              {
                  "name": test_dict[("right3")][3][1]['team'],
                  "seed_id": test_dict[("right3")][3][0],
                  "right": [
                          {
                          "name": test_dict[("right4")][6][1]['team'],
                          "seed_id": test_dict[("right4")][6][0],
                          "right": [
                          {
                          "name": test_dict[("right5")][12][1]['team'],
                          "seed_id": test_dict[("right5")][12][0],
                          "right": [
                          {
                          "name": test_dict[("right6")][24][1]['team'],
                          "seed_id": test_dict[("right6")][24][0]
                          },
                          {
                          "name": test_dict[("right6")][25][1]['team'],
                          "seed_id": test_dict[("right6")][25][0]
                          }    
                          ]
                          },
                          {
                          "name": test_dict[("right5")][13][1]['team'],
                          "seed_id": test_dict[("right5")][13][0],
                          "right": [
                          {
                          "name": test_dict[("right6")][26][1]['team'],
                          "seed_id": test_dict[("right6")][26][0]
                          },
                          {
                          "name": test_dict[("right6")][27][1]['team'],
                          "seed_id": test_dict[("right6")][27][0]
                          }    
                          ]
                          }
                          ]
                          },
                          {
                          "name": test_dict[("right4")][7][1]['team'],
                          "seed_id": test_dict[("right4")][7][0],
                          "right": [
                          {
                          "name": test_dict[("right5")][14][1]['team'],
                          "seed_id": test_dict[("right5")][14][0],
                          "right": [
                          {
                          "name": test_dict[("right6")][28][1]['team'],
                          "seed_id": test_dict[("right6")][28][0]
                          },
                          {
                          "name": test_dict[("right6")][29][1]['team'],
                          "seed_id": test_dict[("right6")][29][0]
                          }    
                          ]
                          },
                          {
                          "name": test_dict[("right5")][15][1]['team'],
                          "seed_id": test_dict[("right5")][15][0],
                          "right": [
                          {
                          "name": test_dict[("right6")][30][1]['team'],
                          "seed_id": test_dict[("right6")][30][0]
                          },
                          {
                          "name": test_dict[("right6")][31][1]['team'],
                          "seed_id": test_dict[("right6")][31][0]
                          }    
                          ]
                          }
                          ]
                          }
              ]
              }
]
}
]}];
  slots.x0 = height / 2;
  slots.y0 = width / 2;
  
  var t1 = d3.layout.tree().size([height, halfWidth]).children(function(d){return d.left;}).value(function(d){return d.seed_id;}),
      t2 = d3.layout.tree().size([height, halfWidth]).children(function(d){return d.right;}).value(function(d){return d.seed_id;});
  t1.nodes(slots);
  t2.nodes(slots);
  
  var rebuildChildren = function(node){
    node.children = getChildren(node);
    if(node.children) node.children.forEach(rebuildChildren);
  }
  rebuildChildren(slots);
  slots.isRight = false;
  return slots
}

d3.json("static/bracket_dict.JSON", function(bracket){
  d3.json("static/probs.json", function(probs){
    d3.json("static/team_images.JSON", function(imgs){
      update(bracket, probs, imgs);
    });
  });
});
var toArray = function(item, arr){
  arr = arr || [];
  var i = 0, l = item.children?item.children.length:0;
  arr.push(item);
  for(; i < l; i++){
    toArray(item.children[i], arr);
  }
  return arr;
};

function update(bracket, probs, imgs) {
  // Compute the new tree layout.
  source = list_to_tree(bracket);
  var nodes = toArray(source);
  // Normalize for fixed-depth.

  var node_updates = Object;

  nodes.forEach(function(d) { 
    d.y = d.depth * 150 + halfWidth;
    if(d.seed_id in node_updates){
      d.name = node_updates[d.seed_id];
    };
  });
  for(var c = 0; c < 6; c++){
    nodes.forEach(function(d) { 
      if(d.children){
        if(d.children[0].name != d.name & d.children[1].name != d.name){
          d.name = "";
      }};
    });};

  // Update the nodesâ€¦
  var node = vis.selectAll("g.node")
      .data(nodes, function(d) { return d.id || (d.id = ++i); });

  // Enter any new nodes at the parent's previous position.
  var nodeEnter = node.enter().append("g")
      .attr("class", "node")
      .attr("transform", function(d) { return "translate(" + source.y0 + "," + source.x0 + ")"; })
      .on("click", click);

  nodeEnter.append("image")
      .attr("dy", "20")
      .attr("xlink:href", function(d){
        if(d.name in imgs){
        return imgs[d.name];}
        else{return "https://www.transparenttextures.com/patterns/debut-light.png";}
      })
      .attr("width", function(d){return d.name != ""?20:1;})
      .attr("height", function(d){return d.name != ""?20:1;});

  nodeEnter.append("text")
      .attr("dy", function(d) { return -2;})
      .attr("dx", function(d) { return d.isRight?-65:-60;})
      .attr("text-anchor", function(d){return d.isRight?"left":"right";})
      .text(function(d) { 
        return d.name;
      })
      .on("click", click);

  nodeEnter.append("text")
      .attr("dy", function(d) { return -6;})
      .attr("dx", function(d) { return d.isRight?40:45;})
      .attr("text-anchor", "right")
      .text(function(d) { 
        if(d.parent){if(d.name != ""){
          var team_1_split = d.name.split(" ");
          var team_1 = team_1_split.slice(1, team_1_split.length).join(" ");
          var team_2_options = d.parent.children;
          var team_2_choice = "";
          if(team_2_options[0].name == d.name){team_2_choice = team_2_options[1].name.split(" ");}
            else{
              {team_2_choice = team_2_options[0].name.split(" ");}
          };
          var team_2 = team_2_choice.slice(1, team_2_choice.length).join(" ");
          if(team_2 != ""){
          return  Math.round(probs[team_1][team_2]*100) + "%";}}}
        else{return "";}
      })
      .style("font-weight", "bold")
      .style("font-size", "14px")
      .style("fill", function(d){
        if(d.parent){if(d.name != ""){
          var team_1_split = d.name.split(" ");
          var team_1 = team_1_split.slice(1, team_1_split.length).join(" ");
          var team_2_options = d.parent.children;
          var team_2_choice = "";
          if(team_2_options[0].name == d.name){team_2_choice = team_2_options[1].name.split(" ");}
            else{
              {team_2_choice = team_2_options[0].name.split(" ");}
          };
          var team_2 = team_2_choice.slice(1, team_2_choice.length).join(" ");
          if(team_2 != ""){
          var prob = Math.round(probs[team_1][team_2]*100);
          if(prob > 50){
            return "green";
          }
          else if(prob < 50){return "red";}
          else{return "black";}
        }
        else{return "black";}
      }
      else{return "black";}
    }
    else{return "black";}
      });

  // Transition nodes to their new position.
  var nodeUpdate = node.transition()
      .duration(0)
      .attr("transform", function(d) { p = calcLeft(d); return "translate(" + p.y + "," + p.x + ")"; })
      ;

  nodeUpdate.select("circle")
      .attr("r", 4.5)
      .style("fill", function(d) { return d._children ? "lightsteelblue" : "#fff"; });


  // Transition exiting nodes to the parent's new position.
  var nodeExit = node.exit().transition()
      .duration(0)
      .attr("transform", function(d) { p = calcLeft(d.parent||source); return "translate(" + p.y + "," + p.x + ")"; })
      .remove();

  nodeExit.select("circle")
      .attr("r", 1e-6);

  // Update the links...
  var link = vis.selectAll("path.link")
      .data(tree.links(nodes), function(d) { return d.target.id; });

  // Enter any new links at the parent's previous position.
  link.enter().insert("path", "g")
      .attr("class", "link")
      .attr("d", function(d) {
        var o = {x: source.x0, y: source.y0};
        return connector({source: o, target: o});
      });

  // Transition links to their new position.
  link.transition()
      .duration(0)
      .attr("d", connector);

  // Transition exiting nodes to the parent's new position.
  link.exit().transition()
      .duration(0)
      .attr("d", function(d) {
        var o = calcLeft(d.source||source);
        if(d.source.isRight) o.y -= halfWidth - (d.target.y - d.source.y);
        else o.y += halfWidth - (d.target.y - d.source.y);
        return connector({source: o, target: o});
      })
      .remove();

  // Stash the old positions for transition.
  nodes.forEach(function(d) {
    var p = calcLeft(d);
    d.x0 = p.x;
    d.y0 = p.y;
  });
  
  // Toggle children on click.
  function click(d) {
    var node_parent = d.parent.seed_id;
    var current_team = d.name;
    node_updates[node_parent] = current_team;
    update(bracket, probs, imgs);
  }
}


    </script>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-63567020-2', 'auto');
  ga('send', 'pageview');

</script>
  </body>
</html>
